<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Airbnb Dashboard </title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#0b1220;color:#f1f5f9;padding:16px}
    h1{margin:0;font-size:22px}
    .header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:10px}
    .card{background:#111827;padding:14px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.5);margin-top:10px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(420px,1fr));gap:14px;margin-top:14px}
    .kpis{display:flex;gap:10px;justify-content:space-around;flex-wrap:wrap;margin-top:14px}
    .kpi{background:#1f2937;padding:10px;border-radius:8px;flex:1;min-width:150px;text-align:center}
    label{font-size:13px;color:#9ca3af;display:block;margin-bottom:6px}
    select,input[type=range]{width:100%;padding:6px;border-radius:6px;border:none;background:#1f2937;color:#f1f5f9}
    #map{height:360px;border-radius:8px}
    button{padding:6px 10px;background:#6366f1;color:white;border:none;border-radius:6px;cursor:pointer;margin-top:6px}
    .footer{margin-top:20px;color:#9ca3af;font-size:13px;text-align:center}
  </style>
</head>
<body>
  <div class="header">
     <div style="display:flex;align-items:center;gap:10px;">
    <img src="https://logosmarcas.net/wp-content/uploads/2020/07/Airbnb-Emblema.jpg" alt="Airbnb Logo" style="height:40px;">
      <h1> Airbnb Dashboard </h1>
      <div style="color:#9ca3af;font-size:13px">Upload your JSON file and explore insights interactively</div>
    </div>
    <div class="card">
      <label>Upload JSON File</label>
      <input id="file" type="file" accept="application/json">
      <button id="resetBtn">Reset Filters</button>
      <button id="downloadFiltered">Download Filtered JSON</button>
    </div>
  </div>

  <div class="grid">
    <div class="card">
      <label>City</label>
      <select id="citySelect"><option value="All">All</option></select>
      <label>Neighbourhood (multi-select)</label>
      <select id="neighSelect" multiple size="6"></select>
      <label>Room Type</label>
      <select id="roomSelect"><option value="All">All</option></select>
      <label>Max Price</label>
      <input id="priceRange" type="range" min="0" max="1000" value="500">
      <div><span id="priceVal">500</span></div>
      <label>Min Reviews</label>
      <input id="minReviews" type="range" min="0" max="1000" value="0">
      <div><span id="revVal">0</span></div>
      <label>Host Listings Count ≥</label>
      <input id="hostListings" type="range" min="0" max="50" value="0">
      <div><span id="hostVal">0</span></div>
    </div>

    <div class="card kpis">
      <div class="kpi"><div>Total Listings</div><div id="totalListings">—</div></div>
      <div class="kpi"><div>Avg Price</div><div id="avgPrice">—</div></div>
      <div class="kpi"><div>Median Price</div><div id="medianPrice">—</div></div>
      <div class="kpi"><div>Avg Reviews</div><div id="avgReviews">—</div></div>
    </div>

    <div class="card full"><div id="map"></div></div>
    <div class="card"><div id="barNeigh"></div></div>
    <div class="card"><div id="pieTypes"></div></div>
    <div class="card"><div id="scatterPriceReviews"></div></div>
    <div class="card"><div id="boxNeigh"></div></div>
    <div class="card full"><div id="hostScatter"></div></div>
  </div>

  <div class="footer">Airbnb Dashboard v2 - devloped by Mohd Aarish With Love❤️</div>

<script>
let rawData=[],filtered=[];let map,layer;

function summarize(d){let t=d.length;let p=d.map(r=>+r.price).filter(n=>!isNaN(n));let avg=(p.reduce((a,b)=>a+b,0)/p.length)||0;let med=p.sort((a,b)=>a-b)[Math.floor(p.length/2)]||0;let avgRev=(d.reduce((s,r)=>s+(+r.number_of_reviews||0),0)/t)||0;return{t,avg:avg.toFixed(1),med:med,avgRev:avgRev.toFixed(1)};}
function renderKPIs(d){let s=summarize(d);document.getElementById("totalListings").innerText=s.t;document.getElementById("avgPrice").innerText="$"+s.avg;document.getElementById("medianPrice").innerText="$"+s.med;document.getElementById("avgReviews").innerText=s.avgRev;}

function populateControls(d){let cities=[...new Set(d.map(r=>r.city))].filter(x=>x);let citySel=document.getElementById("citySelect");citySel.innerHTML='<option value="All">All</option>'+cities.map(c=>`<option>${c}</option>`).join("");let neighs=[...new Set(d.map(r=>r.neighbourhood_clean))].filter(x=>x);let sel=document.getElementById("neighSelect");sel.innerHTML=neighs.map(n=>`<option>${n}</option>`).join("");let rooms=[...new Set(d.map(r=>r.room_type))].filter(x=>x);let roomSel=document.getElementById("roomSelect");roomSel.innerHTML='<option value="All">All</option>'+rooms.map(r=>`<option>${r}</option>`).join("");}

function applyFilters(){let city=document.getElementById("citySelect").value;let neigh=[...document.getElementById("neighSelect").selectedOptions].map(o=>o.value);let room=document.getElementById("roomSelect").value;let maxP=+document.getElementById("priceRange").value;let minR=+document.getElementById("minReviews").value;let hostMin=+document.getElementById("hostListings").value;filtered=rawData.filter(r=>{if(city!=="All"&&r.city!==city)return false;if(neigh.length&&!neigh.includes(r.neighbourhood_clean))return false;if(room!=="All"&&r.room_type!==room)return false;if(r.price>maxP)return false;if(r.number_of_reviews<minR)return false;if(r.host_listings_count<hostMin)return false;return true;});renderKPIs(filtered);renderCharts(filtered);}

function renderCharts(d){renderMap(d);renderNeighbourhood(d);renderPie(d);renderScatter(d);renderBox(d);renderHost(d);}
function renderMap(d){if(!map){map=L.map("map").setView([41.88,-87.63],11);L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);layer=L.layerGroup().addTo(map);}layer.clearLayers();d.forEach(r=>{if(r.latitude&&r.longitude){let m=L.circleMarker([r.latitude,r.longitude],{radius:5,color:"#6366f1",fill:true,fillOpacity:0.7});m.bindPopup(`${r.name}<br/>${r.neighbourhood_clean} — $${r.price}<br/>Host: ${r.host_name}`);layer.addLayer(m);}});if(d.length>0){const bounds=L.latLngBounds(d.map(r=>[r.latitude,r.longitude]));map.fitBounds(bounds,{padding:[30,30]});}}

function renderNeighbourhood(d){let m={};d.forEach(r=>{let n=r.neighbourhood_clean||"Unknown";if(!m[n])m[n]={c:0,t:0};m[n].c++;m[n].t+=+r.price;});let neigh=Object.keys(m).sort((a,b)=>m[b].c-m[a].c).slice(0,15);let counts=neigh.map(n=>m[n].c);let avg=neigh.map(n=>(m[n].t/m[n].c).toFixed(1));Plotly.newPlot("barNeigh",[ {x:neigh,y:counts,type:"bar",name:"Listings"}, {x:neigh,y:avg,type:"scatter",mode:"lines+markers",name:"Avg Price",yaxis:"y2"} ],{title:"Popular Neighbourhoods",yaxis:{title:"Listings"},yaxis2:{overlaying:"y",side:"right",title:"Avg Price"}});}

function renderPie(d){let m={};d.forEach(r=>{m[r.room_type]=(m[r.room_type]||0)+1});Plotly.newPlot("pieTypes",[ {labels:Object.keys(m),values:Object.values(m),type:"pie"} ],{title:"Room Types"});}

function renderScatter(d){let x=d.map(r=>+r.number_of_reviews);let y=d.map(r=>+r.price);Plotly.newPlot("scatterPriceReviews",[ {x,y,mode:"markers",type:"scatter",marker:{size:7,opacity:0.6}} ],{title:"Price vs Reviews",xaxis:{title:"Reviews"},yaxis:{title:"Price"}});}

function renderBox(d){let m={};d.forEach(r=>{let n=r.neighbourhood_clean||"Unknown";(m[n]=m[n]||[]).push(+r.price)});let neigh=Object.keys(m).slice(0,10);let traces=neigh.map(n=>({y:m[n],type:"box",name:n}));Plotly.newPlot("boxNeigh",traces,{title:"Price Distribution by Neighbourhood"});}

function renderHost(d){let m={};d.forEach(r=>{let h=r.host_id;if(!m[h])m[h]={tp:0,tr:0,c:0,name:r.host_name};m[h].tp+=+r.price;m[h].tr+=+r.number_of_reviews;m[h].c++;});let x=Object.values(m).map(v=>v.tr/v.c);let y=Object.values(m).map(v=>v.tp/v.c);let text=Object.values(m).map(v=>`${v.name} (${v.c} listings)`);Plotly.newPlot("hostScatter",[ {x,y,text,mode:"markers",type:"scatter"} ],{title:"Host Analysis",xaxis:{title:"Avg Reviews"},yaxis:{title:"Avg Price"}});}

document.getElementById("file").addEventListener("change",e=>{let f=e.target.files[0];if(!f)return;let r=new FileReader();r.onload=ev=>{try{rawData=JSON.parse(ev.target.result);rawData=rawData.map(x=>({...x,price:+x.price,number_of_reviews:+x.number_of_reviews,latitude:+x.latitude,longitude:+x.longitude,host_listings_count:+x.host_listings_count}));populateControls(rawData);applyFilters();}catch(err){alert("Invalid JSON "+err)}};r.readAsText(f);});
document.getElementById("citySelect").addEventListener("change",applyFilters);
document.getElementById("neighSelect").addEventListener("change",applyFilters);
document.getElementById("roomSelect").addEventListener("change",applyFilters);
document.getElementById("priceRange").addEventListener("input",e=>{document.getElementById("priceVal").innerText=e.target.value;applyFilters();});
document.getElementById("minReviews").addEventListener("input",e=>{document.getElementById("revVal").innerText=e.target.value;applyFilters();});
document.getElementById("hostListings").addEventListener("input",e=>{document.getElementById("hostVal").innerText=e.target.value;applyFilters();});
document.getElementById("resetBtn").addEventListener("click",()=>{document.getElementById("citySelect").value="All";document.getElementById("neighSelect").selectedIndex=-1;document.getElementById("roomSelect").value="All";document.getElementById("priceRange").value=1000;document.getElementById("priceVal").innerText="1000";document.getElementById("minReviews").value=0;document.getElementById("revVal").innerText="0";document.getElementById("hostListings").value=0;document.getElementById("hostVal").innerText="0";applyFilters();});
document.getElementById("downloadFiltered").addEventListener("click",()=>{let blob=new Blob([JSON.stringify(filtered,null,2)],{type:"application/json"});let url=URL.createObjectURL(blob);let a=document.createElement("a");a.href=url;a.download="filtered_airbnb.json";a.click();URL.revokeObjectURL(url);});
</script>
</body>
</html>
